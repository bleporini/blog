
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>AngularJS + Play! Framework&#58; Authentification</title>
    
    <meta name="author" content="Brice LEPORINI">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

      <link href="/assets/css/tbt.css" rel="stylesheet">
      <link href="/assets/themes/bootstrap/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
      <link href="assets/css/github.css" rel="stylesheet">

      <!--SYNTAX HIGHLIGHTER BEGINS -->
      <link href='/assets/css/shCore.css' rel='stylesheet' type='text/css'/>
      <link href='/assets/css/shThemeDefault.css' rel='stylesheet' type='text/css'/>
      <script src='/assets/js/sh/shCore.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushCpp.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushCSharp.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushCss.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushJava.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushJScript.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushPhp.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushPython.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushRuby.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushSql.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushVb.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushXml.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushPerl.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushScala.js' type='text/javascript'></script>
      <script src='/assets/js/sh/shBrushBash.js' type='text/javascript'></script>
      <script language='javascript'>
          SyntaxHighlighter.config.bloggerMode = true;
          SyntaxHighlighter.config.clipboardSwf = 'http://alexgorbatchev.com/pub/sh/current/scripts/clipboard.swf';
          SyntaxHighlighter.all();
      </script>

      <!--SYNTAX HIGHLIGHTER ENDS-->
  
    <!--[if lt IE 9]>
      <script src="/assets/themes/bootstrap/resources/respond/Respond.min.js"></script>
    <![endif]-->

    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
  <nav class="navbar navbar-default" role="navigation">
      <div class="container">
          <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="/">The Babel Tower</a>
          </div>

          <div class="collapse navbar-collapse navbar-ex1-collapse">
              <ul class="nav navbar-nav">
                  
                  
                  


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



              </ul>
          </div>
      </div>
  </nav>

  <div class="container">
      <div class="row">
          <div class="col-md-3 hidden-xs hidden-sm">
              <div class="well">
                  <div class="nav nav-stacked side-bar">

                      <img src="/assets/img/gravatar.jpeg" alt="gravatar">

                      <a href="https://twitter.com/blep" class="twitter-follow-button" data-show-count="false" data-lang="fr" data-size="large">Suivre @blep</a>
                      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

                      
                      


<ul class="post-collate-side">
  
    
    
    
    
  
    
      <li><a data-toggle="collapse" href="#ul2014">2014</a>
        <ul class="collapse post-collate-side" id="ul2014">
            <li>April
             <ul>
    
  
    <li><span>2014-04-25</span> &raquo; <a href="/2014/04/25/test-post">test post</a></li>
  
    
          
        
            </ul></li>
          <li>February</li>
          <ul>
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2014-02-07</span> &raquo; <a href="/2014/02/07/XMLUnit%253A%2Bune%2Bpetite%2Blib%2Bqui%2Bd%25C3%25A9panne%2Bbien">XMLUnit&#58; une petite lib qui dépanne bien</a></li>
  
    
      
             </ul></li>
         </ul></li>
      <li><a data-toggle="collapse" href="#ul2013">2013</a>
        <ul class="collapse" id="ul2013">
            <li>August
             <ul>
      
    
  
    
    
    
    
  
    
  
    <li><span>2013-08-21</span> &raquo; <a href="/2013/08/21/JVM%253A%2BLe%2Bprix%2Bde%2Bl%2527immutabilit%25C3%25A9">JVM&#58; Le prix de l'immutabilité</a></li>
  
    
          
        
            </ul></li>
          <li>April</li>
          <ul>
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2013-04-19</span> &raquo; <a href="/2013/04/19/Why%2BScala%253A%2BLa%2Bstack%2B%25282%252F2%2529">Why Scala&#58; La stack (2/2)</a></li>
  
    
          
        
            </ul></li>
          <li>March</li>
          <ul>
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2013-03-31</span> &raquo; <a href="/2013/03/31/Retour%2Bsur%2BDevoxxFr%2B2013">Retour sur DevoxxFr 2013</a></li>
  
    
          
        
            </ul></li>
          <li>February</li>
          <ul>
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2013-02-22</span> &raquo; <a href="/2013/02/22/Why%2BScala%253A%2BLa%2Bstack%2B%25281%252F2%2529">Why Scala&#58; La stack (1/2)</a></li>
  
    
          
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2013-02-02</span> &raquo; <a href="/2013/02/02/Why%2BScala%253F">Why Scala?</a></li>
  
    
          
        
            </ul></li>
          <li>January</li>
          <ul>
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2013-01-06</span> &raquo; <a href="/2013/01/06/AngularJS%2B%252B%2BPlay%2521%2BFramework%253A%2BAuthentification">AngularJS + Play! Framework&#58; Authentification</a></li>
  
    
      
             </ul></li>
         </ul></li>
      <li><a data-toggle="collapse" href="#ul2012">2012</a>
        <ul class="collapse" id="ul2012">
            <li>October
             <ul>
      
    
  
    
    
    
    
  
    
  
    <li><span>2012-10-27</span> &raquo; <a href="/2012/10/27/Taille%2Bde%2Bsession%2BHTTP">Taille de session HTTP</a></li>
  
    
          
        
            </ul></li>
          <li>August</li>
          <ul>
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2012-08-10</span> &raquo; <a href="/2012/08/10/Java%2Bet%2BVMWare">Java et VMWare</a></li>
  
    
          
        
            </ul></li>
          <li>March</li>
          <ul>
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2012-03-16</span> &raquo; <a href="/2012/03/16/JPA%252C%2BHibernate%2Bet%2Brequ%25C3%25AAte%2Bconstructeur">JPA, Hibernate et requête constructeur</a></li>
  
    
      
             </ul></li>
         </ul></li>
      <li><a data-toggle="collapse" href="#ul2011">2011</a>
        <ul class="collapse" id="ul2011">
            <li>May
             <ul>
      
    
  
    
    
    
    
  
    
  
    <li><span>2011-05-19</span> &raquo; <a href="/2011/05/19/Cr%25C3%25A9ation%2Bd%2527une%2Bmini%2BPKI">Création d'une mini PKI</a></li>
  
    
          
        
            </ul></li>
          <li>February</li>
          <ul>
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2011-02-26</span> &raquo; <a href="/2011/02/26/MVP%2Bet%2BGWT">MVP et GWT</a></li>
  
    
          
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2011-02-18</span> &raquo; <a href="/2011/02/18/Message%2BDriven%2BBean%253A%2Bconfiguration%2Bde%2Bl%2527acc%25C3%25A8s%2B%25C3%25A0%2Bune%2BDestination%2Bs%25C3%25A9curis%25C3%25A9e">Message Driven Bean&#58; configuration de l'accès à une Destination sécurisée</a></li>
  
    
          
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2011-02-18</span> &raquo; <a href="/2011/02/18/MDB%253A%2Butiliser%2Bdes%2BEJB%2Bs%25C3%25A9curis%25C3%25A9s">MDB&#58; utiliser des EJB sécurisés</a></li>
  
    
          
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2011-02-10</span> &raquo; <a href="/2011/02/10/Aspirer%2Bun%2Bsite%2Bavec%2Bwget">Aspirer un site avec wget</a></li>
  
    
          
        
            </ul></li>
          <li>January</li>
          <ul>
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2011-01-31</span> &raquo; <a href="/2011/01/31/Maven%2BSurefire%253A%2BLancer%2Bun%2Bseul%2Btest">Maven Surefire&#58; Lancer un seul test</a></li>
  
    
          
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2011-01-24</span> &raquo; <a href="/2011/01/24/Hibernate%253A%2Bvaleur%2Bdes%2Bparam%25C3%25A8tres%2Bet%2Blog">Hibernate&#58; valeur des paramètres et log</a></li>
  
    
      
             </ul></li>
         </ul></li>
      <li><a data-toggle="collapse" href="#ul2008">2008</a>
        <ul class="collapse" id="ul2008">
            <li>December
             <ul>
      
    
  
    
    
    
    
  
    
  
    <li><span>2008-12-24</span> &raquo; <a href="/2008/12/24/Windows%2Bet%2Bles%2Bvariables%2Bd%2527environnement">Windows et les variables d'environnement</a></li>
  
    
      
             </ul></li>
         </ul></li>
      <li><a data-toggle="collapse" href="#ul2007">2007</a>
        <ul class="collapse" id="ul2007">
            <li>June
             <ul>
      
    
  
    
    
    
    
  
    
  
    <li><span>2007-06-01</span> &raquo; <a href="/2007/06/01/WebServices%2BEJB%2B3%253A%2BTrop%2Bfastoche">WebServices EJB 3&#58; Trop fastoche</a></li>
  
    
          
        
            </ul></li>
          <li>May</li>
          <ul>
        
      
    
  
    
    
    
    
  
    
  
    <li><span>2007-05-09</span> &raquo; <a href="/2007/05/09/Premier">Premier</a></li>
  
    
             </ul></li>
         </ul></li>
     </ul>
    
  




                      <span style='font-size: 130%'><a href='tags.html#mdb-ref'>mdb</a></span>
<span style='font-size: 65%'><a href='tags.html#maven-ref'>maven</a></span>
<span style='font-size: 65%'><a href='tags.html#profiling-ref'>profiling</a></span>
<span style='font-size: 65%'><a href='tags.html#service-ref'>service</a></span>
<span style='font-size: 65%'><a href='tags.html#web-ref'>web</a></span>
<span style='font-size: 65%'><a href='tags.html#xml-ref'>xml</a></span>
<span style='font-size: 65%'><a href='tags.html#junit-ref'>junit</a></span>
<span style='font-size: 65%'><a href='tags.html#windows-ref'>windows</a></span>
<span style='font-size: 65%'><a href='tags.html#jvm-ref'>jvm</a></span>
<span style='font-size: 65%'><a href='tags.html#mvp-ref'>mvp</a></span>
<span style='font-size: 65%'><a href='tags.html#wget-ref'>wget</a></span>
<span style='font-size: 65%'><a href='tags.html#hibernate-ref'>hibernate</a></span>
<span style='font-size: 458%'><a href='tags.html#java-ref'>java</a></span>
<span style='font-size: 65%'><a href='tags.html#j2ee-ref'>j2ee</a></span>
<span style='font-size: 65%'><a href='tags.html#xmlunit-ref'>xmlunit</a></span>
<span style='font-size: 65%'><a href='tags.html#slick-ref'>slick</a></span>
<span style='font-size: 130%'><a href='tags.html#play-ref'>play</a></span>
<span style='font-size: 65%'><a href='tags.html#guava-ref'>guava</a></span>
<span style='font-size: 130%'><a href='tags.html#javaee-ref'>javaee</a></span>
<span style='font-size: 130%'><a href='tags.html#test-ref'>test</a></span>
<span style='font-size: 65%'><a href='tags.html#devoxxfr13-ref'>devoxxfr13</a></span>
<span style='font-size: 65%'><a href='tags.html#gc-ref'>gc</a></span>
<span style='font-size: 130%'><a href='tags.html#javascript-ref'>javascript</a></span>
<span style='font-size: 65%'><a href='tags.html#authentification-ref'>authentification</a></span>
<span style='font-size: 130%'><a href='tags.html#sécurité-ref'>sécurité</a></span>
<span style='font-size: 65%'><a href='tags.html#mutabilité-ref'>mutabilité</a></span>
<span style='font-size: 392%'><a href='tags.html#scala-ref'>scala</a></span>
<span style='font-size: 65%'><a href='tags.html#angularjs-ref'>angularjs</a></span>
<span style='font-size: 65%'><a href='tags.html#jpa-ref'>jpa</a></span>
<span style='font-size: 65%'><a href='tags.html#gwt-ref'>gwt</a></span>
<span style='font-size: 196%'><a href='tags.html#ejb-ref'>ejb</a></span>
<span style='font-size: 65%'><a href='tags.html#immutabilité-ref'>immutabilité</a></span>
<span style='font-size: 65%'><a href='tags.html#bigdata-ref'>bigdata</a></span>
<span style='font-size: 65%'><a href='tags.html#sbt-ref'>sbt</a></span>
<span style='font-size: 65%'><a href='tags.html#visualvm-ref'>visualvm</a></span>
<span style='font-size: 65%'><a href='tags.html#ssl-ref'>ssl</a></span>


                  </div>
              </div>
          </div>
          <div class="col-md-9">
              
<div class="page-header">
  <h1>AngularJS + Play! Framework&#58; Authentification </h1>
</div>

<div class="row post-full">
  <div class="col-md-12">
    <div class="date">
      <span>2013-01-06</span>
    </div>
    <div class="content">
      
<br />En tant que newbie sur Angular, je me suis pos&eacute; la question de l'authentification dans ce type d'applications. 
<br />Pour ceux qui veulent aller directement &agrave; la pr&eacute;sentation du code, c'est 
<a href="http://www.blogger.com/blogger.g?blogID=4336356511014175329#showMeCode">l&agrave;</a>. 
<br /> 
<div style="color: grey; font-style: italic;">
  Depuis longtemps je suis habitu&eacute; au d&eacute;veloppement de web apps dont les pages sont g&eacute;n&eacute;r&eacute;es dynamiquement sur le serveur (JSP, JSF, PHP, etc.): cette probl&eacute;matique est donc combl&eacute;e dans la plupart des cas par une redirection vers un formulaire d'authentification. Or avec un framework du type AngularJS, les pages sont g&eacute;n&eacute;r&eacute;es dynamiquement sur le client &agrave; partir de templates nourries de donn&eacute;es obtenues du serveur collect&eacute;es gr&acirc;ce &agrave; du code client (Javasript). 
 <br />D'un point de vue technique cette approche a &eacute;videmment &eacute;norm&eacute;ment de sens, car: 
 <br /> 
 <br /> 
 <ul> 
  <li>Toutes les ressources clientes sont donc &quot;cachables&quot;: templates, Javascript</li> 
  <li>A l'heure du Cloud (un buzzword, un), le co&ucirc;t d'h&eacute;bergement est proportionnel &agrave; la sollicitation, il est tout naturel de transf&eacute;rer sur la machine du client (gratuite) toute charge &eacute;ligilble</li> 
  <li>L'&eacute;tat du client est g&eacute;r&eacute;... sur le client (un truc de malade), permettant de r&eacute;duire la pression sur la m&eacute;moire de la partie serveur (au point pr&eacute;c&eacute;dent on a &eacute;conomis&eacute; de la CPU, l&agrave; on s'occupe de la RAM!). Sans compter que si la partie serveur ne maintient plus d'&eacute;tat, n'importe quelle instance pourra servir n'importe quelle requ&ecirc;te... Nous parlons donc de conception Stateless (buzzword #2), permettant de d&eacute;ployer les noeuds en ayant aucun autre souci que la r&eacute;partition de charge (pas de synchronisation entre les noeuds), m'amenant tout doucement vers le 3&egrave;me buzzword, la scalabilit&eacute; horizontale.</li> 
 </ul> 
 <br />En r&eacute;fl&eacute;chissant, si la traditionnelle redirection vers le formulaire de login ne semble pas &ecirc;tre une option adapt&eacute;e, que reste-t-il? Facile: le protocole HTTP pr&eacute;voit au moins deux codes de retour li&eacute;s aux probl&egrave;mes de contr&ocirc;les d'acc&egrave;s: 401, authentification requise, et 403, authentification refus&eacute;e. Parfait, le premier m'explique que je dois pr&eacute;senter mes papiers et le second me signale que l'authentification fournie ne comprend pas l'accr&eacute;ditation n&eacute;cessaire pour acc&eacute;der &agrave; la ressource demand&eacute;e. 
 <br /> 
 <br />Donc me voil&agrave; parti sur Google avec les mots clefs &quot;Angular authentication 401&quot; et je tombe sur un article fort int&eacute;ressant: 
 <a href="http://www.espeo.pl/2012/02/26/authentication-in-angularjs-application">http://www.espeo.pl/2012/02/26/authentication-in-angularjs-application</a> . La d&eacute;monstration est compl&egrave;te: toutes les requ&ecirc;tes tenues en &eacute;chec suite &agrave; une erreur 401 sont bufferis&eacute;es, en attente de la connexion de l'utilisateur et retent&eacute;es le cas &eacute;ch&eacute;ant. Et si on veut quelque chose de plus basique? Un peu plus newbie? Genre une redirection vers un formulaire de login &agrave; la premi&egrave;re erreur 401 et une redirection a la racine suite &agrave; authentification? C'est s&ucirc;rement pas aussi complet, mais l'aspect na&iuml;f permet de monter tranquillement en comp&eacute;tence sur AngularJS. 
</div> 
<br /> 
<a href="http://www.blogger.com/blogger.g?blogID=4336356511014175329" name="showMeCode"> </a>Avant toute chose, il nous faut un backend, mon choix c'est port&eacute; sur Play 2.1-RC1 car: 
<br /> 
<ul> 
 <li>Il est stateless par essence</li> 
 <li>C'est hype, j'en avais envie et c'est moi le chef du blog (#noTroll)</li> 
</ul>Point de d&eacute;part standard avec une application Play vide, ensuite on r&eacute;cup&egrave;re une partie de l'authentification du sample 
<a href="https://github.com/playframework/Play20/tree/master/samples/scala/zentasks">zentask</a> en modifiant quelques aspects: 
<br /> 
<ul> 
 <li>Tout d'abord, en cas de n&eacute;cessit&eacute; d'authentification, pas de redirection =&gt; 401:</li> 
</ul> 
<pre class="brush:scala">&nbsp; private def onUnauthorized(request: RequestHeader) = Results.Redirect(routes.Application.login)<br /></pre>devient: 
<br /> 
<pre class="brush:scala">&nbsp; private def onUnauthorized(request: RequestHeader) = Results.Unauthorized<br /><br /></pre> 
<br /> 
<ul> 
 <li>La d&eacute;monstration n&eacute;cessite une ressource prot&eacute;g&eacute;e:</li> 
</ul> 
<br /> 
<pre class="brush: scala">&nbsp; def protectedResource = IsAuthenticated{<br />&nbsp; &nbsp; username =&gt; _ =&gt;<br />&nbsp; &nbsp; Ok(Json.obj(&quot;test&quot;-&gt;&quot;1234&quot;))<br />&nbsp; }<br /></pre> 
<br /> 
<br /> 
<ul> 
 <li>Comme on veut faire une application cliente qui se connecte &agrave; un backend, pas d'utilisation des templates Play et modification de la route pour que la racine pointe sur une ressource statique:</li> 
</ul>GET &nbsp; &nbsp; / &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; controllers.Assets.at(path=&quot;/public&quot;, file=&quot;index.html&quot;) 
<br /> 
<br />Le code est disponible 
<a href="https://github.com/bleporini/angular-authent">ici</a>. 
<br /> 
<br />V&eacute;rifications: 
<br /> 
<br /> 
<ul> 
 <li>Pas autoris&eacute;:</li> 
</ul> 
<br /> 
<pre class="brush: bash; gutter:false; ">$ curl http://localhost:9000/protectedResource -v<br />* About to connect() to localhost port 9000 (#0)<br />* &nbsp; Trying ::1...<br />* connected<br />* Connected to localhost (::1) port 9000 (#0)<br />&gt; GET /protectedResource HTTP/1.1<br />&gt; User-Agent: curl/7.24.0 (x86_64-apple-darwin12.0) libcurl/7.24.0 OpenSSL/0.9.8r zlib/1.2.5<br />&gt; Host: localhost:9000<br />&gt; Accept: */*<br />&gt;<br />&lt; HTTP/1.1 401 Unauthorized<br />&lt; Content-Length: 0<br />&lt;<br />* Connection #0 to host localhost left intact<br />* Closing connection #0<br /></pre> 
<br />L'application r&eacute;fute bien l'acc&egrave;s avec un code 401. 
<br /> 
<br /> 
<ul> 
 <li>Authentification:</li> 
</ul> 
<br /> 
<pre class="brush: bash; gutter:false; ">$ curl http://localhost:9000/login -d 'mail=tony@stark.com&amp;password=ironman' -v<br />* About to connect() to localhost port 9000 (#0)<br />* &nbsp; Trying ::1...<br />* connected<br />* Connected to localhost (::1) port 9000 (#0)<br />&gt; POST /login HTTP/1.1<br />&gt; User-Agent: curl/7.24.0 (x86_64-apple-darwin12.0) libcurl/7.24.0 OpenSSL/0.9.8r zlib/1.2.5<br />&gt; Host: localhost:9000<br />&gt; Accept: */*<br />&gt; Content-Length: 36<br />&gt; Content-Type: application/x-www-form-urlencoded<br />&gt;<br />* upload completely sent off: 36 out of 36 bytes<br />&lt; HTTP/1.1 200 OK<br />&lt; Set-Cookie: PLAY_SESSION=1701c43b7f845bdde0e38c0f43705d54b6815977-mail%3Atony%40stark.com; Path=/; HTTPOnly<br />&lt; Content-Length: 0<br />&lt;<br />* Connection #0 to host localhost left intact<br />* Closing connection #0</pre> 
<pre class="brush: bash; gutter:false; "></pre>Code 200, un cookie sign&eacute; de session en retour… tout va bien, donc on retente l'acc&egrave;s &agrave; la ressource prot&eacute;g&eacute;e en pr&eacute;sentant le s&eacute;same: 
<br /> 
<br /> 
<pre class="brush: bash; gutter:false; ">$ curl http://localhost:9000/protectedResource -b &quot;PLAY_SESSION=1701c43b7f845bdde0e38c0f43705d54b6815977-mail%3Atony%40stark.com&quot; -v<br />* About to connect() to localhost port 9000 (#0)<br />* &nbsp; Trying ::1...<br />* connected<br />* Connected to localhost (::1) port 9000 (#0)<br />&gt; GET /protectedResource HTTP/1.1<br />&gt; User-Agent: curl/7.24.0 (x86_64-apple-darwin12.0) libcurl/7.24.0 OpenSSL/0.9.8r zlib/1.2.5<br />&gt; Host: localhost:9000<br />&gt; Accept: */*<br />&gt; Cookie: PLAY_SESSION=1701c43b7f845bdde0e38c0f43705d54b6815977-mail%3Atony%40stark.com<br />&gt;<br />&lt; HTTP/1.1 200 OK<br />&lt; Content-Type: application/json; charset=utf-8<br />&lt; Content-Length: 15<br />&lt;<br />* Connection #0 to host localhost left intact<br />{&quot;test&quot;:&quot;1234&quot;}* Closing connection #0</pre> 
<br />On obtient donn&eacute;e attendue, authentification r&eacute;ussie! 
<br /> 
<br />Maintenant je m'attaque au client: 
<br /> 
<br /> 
<pre class="brush:html">&lt;html ng-app=&quot;angularAuth&quot; authenticator&gt;<br />&lt;head&gt;<br />&nbsp; &lt;title&gt;Angular authent&lt;/title&gt;<br />&nbsp; &nbsp; &lt;script type=&quot;text/javascript&quot; src=&quot;/public/javascripts/angular/angular.min.js&quot;&gt;&lt;/script&gt;<br />&nbsp; &nbsp; &lt;script type=&quot;text/javascript&quot; src=&quot;/public/javascripts/angular/angular-resource.min.js&quot;&gt;&lt;/script&gt;<br />&nbsp; &nbsp; &lt;script type=&quot;text/javascript&quot; src=&quot;/public/javascripts/app.js&quot;&gt;&lt;/script&gt;<br />&nbsp; &nbsp; &lt;script type=&quot;text/javascript&quot; src=&quot;/public/javascripts/controllers.js&quot;&gt;&lt;/script&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />&lt;h1&gt;Simple authentication example&lt;/h1&gt;<br />&lt;div ng-view&gt;&lt;/div&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</pre> 
<br />Mon module AngularJS est sommaire: 
<br /> 
<br /> 
<pre class="brush:js">angular.module(&quot;angularAuth&quot;,['authServiceProvider']).<br />&nbsp; &nbsp; config(['$routeProvider',function($routeProvider){<br />&nbsp; &nbsp; &nbsp; &nbsp; $routeProvider.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; when(&quot;/&quot;, {templateUrl:&quot;public/partials/protectedContent.html&quot;, controller:ProtectedCtrl}).<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; when(&quot;/login&quot;,{templateUrl:&quot;public/partials/login.html&quot;, controller:LoginCtrl}).<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; otherwise({redirectTo:&quot;/&quot;})<br />&nbsp; &nbsp; }]).<br />&nbsp; &nbsp; directive('authenticator',function($location){<br />&nbsp; &nbsp; &nbsp; &nbsp; return function(scope, elem, attrs){<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scope.$on('event:auth-loginRequired',function(){<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $location.path(&quot;/login&quot;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; })<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }) &nbsp;;<br /><br /></pre> 
<br />En gros, quand &quot;/&quot; est demand&eacute;, affichage du template tirant la ressource prot&eacute;g&eacute;e et lorsque &quot;/login&quot; est demand&eacute;, affichage du formulaire de login et redirection dans tous les autres cas. 
<br />Ensuite un listener va &ecirc;tre positionn&eacute; afin de r&eacute;agir &agrave; l'&eacute;v&egrave;nement de demande d'authentification. L'utilisation de la directive permet de le placer au niveau du module, soit une fois pour toutes. Ne pas oublier de mentionner la directive dans le fichier html (moi, j'ai cherch&eacute; un moment au d&eacute;but :-D). 
<br /> 
<br />Le concept pr&eacute;sent&eacute; par Witold Szczerba est de tirer parti de la possibilit&eacute; de poser des intercepteurs sur le service $http, c'est ce que je vais faire mais de fa&ccedil;on plus na&iuml;ve dans le module &quot;authServiceProvider&quot; inject&eacute; dans &quot;angularAuth&quot;: 
<br /> 
<br /> 
<pre class="brush:js">angular.module('authServiceProvider', []).<br />    config(['$httpProvider', function($httpProvider) {<br /><br />    $httpProvider.responseInterceptors.push(function($q,$rootScope,$log){<br />        function success(response) {<br />//            $log.info(response)<br />            return response<br />        }<br /><br />        function error(response) {<br />            if (response.status === 401) {<br />                $log.error(&quot;401!!!!&quot;)<br />                $rootScope.$broadcast('event:auth-loginRequired')<br />            }<br />            return $q.reject(response)<br />        }<br /><br />        return function(promise) {<br />            return promise.then(success, error)<br />        }<br /><br />    })<br /><br />}])<br /><br /></pre> 
<br />La fonction: si une requ&ecirc;te retourne une erreur 401, alors l'&eacute;v&egrave;nement de demande d'authentification est propag&eacute; et stimule ainsi la directive et le formulaire de login appara&icirc;t. Je vous &eacute;pargne un couplet sur l'API Promise d'AngularJS et cous encourage &agrave; aller consulter le Reference Guide. 
<br /> 
<br />Les contr&ocirc;leurs du 
<a href="https://github.com/bleporini/angular-authent/blob/master/public/javascripts/controllers.js">formulaire d'authentification, de r&eacute;cup&eacute;ration de la ressource prot&eacute;g&eacute;e</a> et les 
<a href="https://github.com/bleporini/angular-authent/tree/master/public/partials">templates associ&eacute;s</a> sont spartiates et consultables sur GitHub. 
<br /> 
<br />En introduction, j'ai pr&eacute;sent&eacute; les arguments li&eacute;s &agrave; la rationalisation de l'infrastructure d'h&eacute;bergement, en revanche &agrave; l'heure actuelle il est clair que la charge de d&eacute;veloppement est sup&eacute;rieure compar&eacute;e &agrave; une application dans laquelle les vues sont g&eacute;n&eacute;r&eacute;es par le serveur: on y d&eacute;clare simplement l'emplacement du formulaire de login. 
<br /> 
<br />La d&eacute;mo est testable sur 
<a href="http://powerful-reaches-3109.herokuapp.com/">Heroku</a>. 
<br /> 
<br /> 
<br /> 
<br /> 
<br />

    </div>

    

    
      <ul class="tag_box inline">
        
        


  
     
    		<span class="glyphicon glyphicon-tags"></span>
<li><a href="/tags.html#play-ref">play</a></li>
     
    		<span class="glyphicon glyphicon-tags"></span>
<li><a href="/tags.html#scala-ref">scala</a></li>
     
    		<span class="glyphicon glyphicon-tags"></span>
<li><a href="/tags.html#authentification-ref">authentification</a></li>
     
    		<span class="glyphicon glyphicon-tags"></span>
<li><a href="/tags.html#angularjs-ref">angularjs</a></li>
     
    		<span class="glyphicon glyphicon-tags"></span>
<li><a href="/tags.html#javascript-ref">javascript</a></li>
    
  



      </ul>
    

      <a href="https://twitter.com/share" class="twitter-share-button" data-via="blep">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

      <!-- Placez cette balise où vous souhaitez faire apparaître le gadget Bouton +1. -->
      <div class="g-plusone"></div>

      <!-- Placez cette ballise après la dernière balise Bouton +1. -->
      <script type="text/javascript">
          window.___gcfg = {lang: 'fr'};

          (function() {
              var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
              po.src = 'https://apis.google.com/js/platform.js';
              var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
          })();
      </script>

    <hr>
    
    <ul class="pagination">
      
        <li class="prev"><a href="/2012/10/27/Taille%2Bde%2Bsession%2BHTTP" title="Taille de session HTTP">&larr; Précédent</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/2013/02/02/Why%2BScala%253F" title="Why Scala?">Suivant &rarr;</a></li>
      
    </ul>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>



          </div>
      </div>


      <hr>
      <footer>
          <p>
              &copy; 2014 Brice LEPORINI
          <span class="pull-right text-muted">
            powered by
            <a href="http://dbtek.github.io/jekyll-bootstrap-3" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll-Bootstrap-3</a>
            and <a href="http://getbootstrap.com" target="_blank">Twitter Bootstrap 3.0.3</a>
          </span>
          </p>
      </footer>
  </div>


    

    <script src="/assets/themes/bootstrap/resources/jquery/jquery.min.js"></script>
    <script src="/assets/themes/bootstrap/resources/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

